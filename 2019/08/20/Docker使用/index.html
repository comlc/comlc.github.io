<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Docker使用"><meta name="keywords" content="Docker"><meta name="author" content="comlc,undefined"><meta name="copyright" content="comlc"><title>Docker使用 | COMLCのBlog</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.3"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?https://hm.baidu.com/hm.js?66f25c24596db799ce091d9b434b9495";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  localSearch: {"labels":{"input_placeholder":"Search for Posts","hits_empty":"我们没有找到任何搜索结果: ${query}"},"path":"search.xml"}
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#容器VS虚拟机"><span class="toc-number">2.</span> <span class="toc-text">容器VS虚拟机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker基本概念"><span class="toc-number">3.</span> <span class="toc-text">Docker基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker架构"><span class="toc-number">4.</span> <span class="toc-text">Docker架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker安装"><span class="toc-number">5.</span> <span class="toc-text">Docker安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker命令整理"><span class="toc-number">6.</span> <span class="toc-text">Docker命令整理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker私服搭建"><span class="toc-number">7.</span> <span class="toc-text">Docker私服搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker开启远程连接"><span class="toc-number">8.</span> <span class="toc-text">Docker开启远程连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dockerfile语法"><span class="toc-number">9.</span> <span class="toc-text">Dockerfile语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常用Docker镜像安装"><span class="toc-number">10.</span> <span class="toc-text">常用Docker镜像安装</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">comlc</div><div class="author-info__description text-center">九山八海，为一世界，聚千界则成小千世界，此界乘三，无我不断者</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives/"><span class="pull-left">文章</span><span class="pull-right">14</span></a><a class="author-info-articles__tags article-meta" href="/tags/"><span class="pull-left">标签</span><span class="pull-right">28</span></a><a class="author-info-articles__categories article-meta" href="/categories/"><span class="pull-left">分类</span><span class="pull-right">12</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="https://github.com/comlc" target="_blank">Comlc</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/background/bg-1.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">COMLCのBlog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/archives/">归档</a><a class="site-page" href="/categories/">分类</a><a class="site-page" href="/tags/">标签</a><a class="site-page" href="/about/">关于我</a></span></div><div id="post-info"><div id="post-title">Docker使用</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-08-20</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/微服务/">微服务</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/微服务/部署环境/">部署环境</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2019/08/20/Docker使用/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2019/08/20/Docker使用/"></span></a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">2,247</span><span class="post-meta__separator">|</span><span>阅读时长: 9 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div id="post-content"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>docker是一个开源的应用容器引擎。Docker可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的Linux机器上，也可以实现虚拟化。</p>
<a id="more"></a>
<h2 id="容器VS虚拟机"><a href="#容器VS虚拟机" class="headerlink" title="容器VS虚拟机"></a>容器VS虚拟机</h2><blockquote>
<p>传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程；而容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也没有进行硬件虚拟。因此容器要比传统虚拟机更为轻便。  </p>
</blockquote>
<p><img src="/2019/08/20/Docker使用/../../../../img/docker/img1.png" alt="容器和虚拟机对比图"></p>
<blockquote>
<p>容器是一个应用层抽象，用于将代码和依赖资源打包在一起。 多个容器可以在同一台机器上运行，共享操作系统内核，但各自作为独立的进程在用户空间中运行。虚拟机(VM)是一个物理硬件层抽象，用于将一台服务器变成多台服务器。  </p>
</blockquote>
<p><img src="/2019/08/20/Docker使用/../../../../img/docker/img2.png" alt="容器和虚拟机对比图"></p>
<h2 id="Docker基本概念"><a href="#Docker基本概念" class="headerlink" title="Docker基本概念"></a>Docker基本概念</h2><ol>
<li>镜像（Image）就是一个只读模板，类似于Java中的类。</li>
<li>容器（Container）是从镜像创建的运行实例，它可以被启动，开始、停止、删除、每个容器都是互相隔离的，类似于Java中创建的对象。</li>
<li>仓库（Repository）分公共仓库和私有仓库，最大的公开仓库是docker Hub。<br><img src="/2019/08/20/Docker使用/../../../../img/docker/img3.png" alt="Docker运行流程"></li>
</ol>
<h2 id="Docker架构"><a href="#Docker架构" class="headerlink" title="Docker架构"></a>Docker架构</h2><ol>
<li>整体是C/S架构，docker daemon就是docker的守护进程即server端，可以是远程的，也可以是本地的，客户端Docker client是通过rest api进行通信。</li>
<li>docker cli用来管理容器和镜像，客户端提供一个只读镜像，然后通过镜像可以创建多个容器。<br><img src="/2019/08/20/Docker使用/../../../../img/docker/img4.png" alt="Docker结构引擎"></li>
</ol>
<h2 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h2><ol>
<li>更新apt包：<code>sudo apt-get update</code>。</li>
<li>安装以下包以使apt可以通过HTTPS使用存储库（repository）：<code>apt-get install apt-transport-https ca-certificates curl software-properties-common</code>。</li>
<li>添加Docker官方的GPG密钥：<code>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</code>。</li>
<li>使用下面的命令来设置stable存储库：<code>sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;</code>。</li>
<li>安装最新版本的Docker CE：<code>sudo apt-get install -y docker-ce</code>。</li>
<li>查看docker服务是否启动：<code>systemctl status docker</code>，若未启动，执行<code>sudo systemctl start docker</code>。</li>
<li>设置开机自启动：<code>systemctl enable docker.service</code>。</li>
</ol>
<h2 id="Docker命令整理"><a href="#Docker命令整理" class="headerlink" title="Docker命令整理"></a>Docker命令整理</h2><ol>
<li><p>容器操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">docker create # 创建一个容器但是不启动它</span><br><span class="line">docker run # 创建并启动一个容器</span><br><span class="line">docker stop # 停止容器运行，发送信号SIGTERM</span><br><span class="line">docker start # 启动一个停止状态的容器</span><br><span class="line">docker restart # 重启一个容器</span><br><span class="line">docker rm # 删除一个容器</span><br><span class="line">docker kill # 发送信号给容器，默认SIGKILL</span><br><span class="line">docker attach # 连接(进入)到一个正在运行的容器</span><br><span class="line">docker wait # 阻塞一个容器，直到容器停止运行</span><br><span class="line"></span><br><span class="line">docker ps # 显示状态为运行（Up）的容器</span><br><span class="line">docker ps -a # 显示所有容器,包括运行中（Up）的和退出的(Exited)</span><br><span class="line">docker inspect # 深入容器内部获取容器所有信息</span><br><span class="line">docker logs # 查看容器的日志(stdout/stderr)</span><br><span class="line">docker events # 得到docker服务器的实时的事件</span><br><span class="line">docker port # 显示容器的端口映射</span><br><span class="line">docker top # 显示容器的进程信息</span><br><span class="line">docker diff # 显示容器文件系统的前后变化</span><br><span class="line"></span><br><span class="line">docker cp # 从容器里向外拷贝文件或目录</span><br><span class="line">docker export # 将容器整个文件系统导出为一个tar包，不带layers、tag等信息</span><br><span class="line"></span><br><span class="line">docker exec -it [container] /bin/bash #在容器里执行一个命令，可以执行bash进入交互式</span><br></pre></td></tr></table></figure>
</li>
<li><p>镜像操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker images # 显示本地所有的镜像列表</span><br><span class="line">docker import # 从一个tar包创建一个镜像，往往和export结合使用</span><br><span class="line">docker build # 使用Dockerfile创建镜像（推荐）</span><br><span class="line">docker commit # 从容器创建镜像</span><br><span class="line">docker rmi # 删除一个镜像</span><br><span class="line">docker load # 从一个tar包创建一个镜像，和save配合使用</span><br><span class="line">docker save # 将一个镜像保存为一个tar包，带layers和tag信息</span><br><span class="line">docker history # 显示生成一个镜像的历史命令</span><br><span class="line">docker tag # 为镜像起一个别名</span><br><span class="line"></span><br><span class="line">docker login # 登录到一个registry</span><br><span class="line">docker search # 从registry仓库搜索镜像</span><br><span class="line">docker pull # 从仓库下载镜像到本地</span><br><span class="line">docker push # 将一个镜像push到registry仓库中</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Docker私服搭建"><a href="#Docker私服搭建" class="headerlink" title="Docker私服搭建"></a>Docker私服搭建</h2><ol>
<li>拉取registry仓库docker镜像：<code>docker pull registry</code>。</li>
<li>挂载相关的配置：<code>mkdir -p /opt/docker-registry/auth</code>。</li>
<li>生成账号密码comlc/comlc：<code>docker run --entrypoint htpasswd registry -Bbn comlc comlc  &gt;&gt; /docker/registry/auth/htpasswd</code>。</li>
<li><p>设置配置文件：执行<code>mkdir -p /opt/docker-registry/config</code>，新建文件<code>vim /opt/docker-registry/config/config.yml</code>，输入如下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">version: 0.1</span><br><span class="line">log:</span><br><span class="line">  fields:</span><br><span class="line">    service: registry</span><br><span class="line">storage:</span><br><span class="line">  delete:</span><br><span class="line">    enabled: true</span><br><span class="line">  cache:</span><br><span class="line">    blobdescriptor: inmemory</span><br><span class="line">  filesystem:</span><br><span class="line">    rootdirectory: /var/lib/registry</span><br><span class="line">http:</span><br><span class="line">  addr: :5000</span><br><span class="line">  headers:</span><br><span class="line">    X-Content-Type-Options: [nosniff]</span><br><span class="line">health:</span><br><span class="line">  storagedriver:</span><br><span class="line">    enabled: true</span><br><span class="line">    interval: 10s</span><br><span class="line">threshold: 3</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建registry docker进程，执行命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 --restart=always  --name=registry \</span><br><span class="line">-v /opt/docker-registry/:/var/lib/registry/ \</span><br><span class="line">-v /opt/docker-registry/auth/:/auth/ \</span><br><span class="line">-e "REGISTRY_AUTH=htpasswd" \</span><br><span class="line">-e "REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm" \</span><br><span class="line">-e REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd \</span><br><span class="line">registry</span><br></pre></td></tr></table></figure>
</li>
<li><p>验证私服：浏览器<code>http://192.168.2.102:5000/v2/_catalog</code>会要求输入用户名密码。</p>
</li>
</ol>
<h2 id="Docker开启远程连接"><a href="#Docker开启远程连接" class="headerlink" title="Docker开启远程连接"></a>Docker开启远程连接</h2><ol>
<li>开启宿主机的2375端口：修改文件<code>vim /lib/systemd/system/docker.service</code>，将原内容<code>ExecStart=/usr/bin/dockerd -H fd://</code>替换成<code>ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock -H tcp://0.0.0.0:7654</code>。</li>
<li>将port(2375)写入<code>/etc/profile</code>配置，执行<code>export DOCKER_HOST=tcp://0.0.0.0:2375</code>，使配置生效，执行<code>source /etc/profile</code>。</li>
<li>重启docker守护进程：<code>systemctl daemon-reload</code>。</li>
<li>重启Docker服务：<code>systemctl restart docker.service</code>。</li>
<li>验证docker服务是否有问题：<code>docker version</code>，查看端口监听情况：<code>netstat -lntp | grep dockerd</code>。<br><strong><em>Docker私服和远程连接都开启后，即可通过如dockerfile-maven-plugin插件进行远程构建镜像并推到私服</em></strong></li>
</ol>
<h2 id="Dockerfile语法"><a href="#Dockerfile语法" class="headerlink" title="Dockerfile语法"></a>Dockerfile语法</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">FROM openjdk:8u181-jdk-stretch                  #指定基础镜像，必须为第一个命令</span><br><span class="line"></span><br><span class="line">ENV JAVA_OPTS=" -Xms256M "                      #设置环境变量，后续可以被RUN指令使用，容器运行起来之后，也可以在容器中获取这些环境变量</span><br><span class="line"></span><br><span class="line">ARG OAP_CONFIG                                  #定义一个变量，在docker build创建镜像的时候，使用--build-arg=来指定参数，在dockerfile-maven-plugin插件通过buildArgs来指定</span><br><span class="line">ARG OAP_LIBS</span><br><span class="line"></span><br><span class="line">WORKDIR skywalking                              #指定配置工作目录，可以使用多个WORKDIR指令，若后续指令用得是相对路径，则会基于之前的命令指定路径</span><br><span class="line"></span><br><span class="line">COPY $&#123;OAP_CONFIG&#125; config/                      #复制本地主机src目录或文件到容器的desc目录</span><br><span class="line">COPY $&#123;OAP_LIBS&#125; oap-libs/</span><br><span class="line">COPY docker-entrypoint.sh .</span><br><span class="line"></span><br><span class="line">RUN mkdir ext-config; \                         #构建镜像时执行的命令，包括shell执行和exec执行</span><br><span class="line">    mkdir ext-libs;</span><br><span class="line"></span><br><span class="line">EXPOSE 12800 11800                              #声明外界交互的端口</span><br><span class="line"></span><br><span class="line">ENTRYPOINT ["bash", "docker-entrypoint.sh"]     #配置容器，使其可执行化。配合CMD可省去"application"，只使用参数</span><br></pre></td></tr></table></figure>
<h2 id="常用Docker镜像安装"><a href="#常用Docker镜像安装" class="headerlink" title="常用Docker镜像安装"></a>常用Docker镜像安装</h2><ol>
<li><p>Mysql镜像安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1、docker pull mysql:8.0.16</span><br><span class="line">2、mkdir -p /opt/docker-mysql/conf.d</span><br><span class="line">增加并修改配置文件config-file.cnf如下</span><br><span class="line">[mysqld]</span><br><span class="line">lower_case_table_names=1 </span><br><span class="line"><span class="meta">#</span>server-id=1</span><br><span class="line">datadir=/opt/docker-mysql/data</span><br><span class="line">character-set-server=utf8</span><br><span class="line">default_authentication_plugin=mysql_native_password</span><br><span class="line">expire_logs_days=7</span><br><span class="line"><span class="meta">#</span>socket=/var/lib/mysql/mysqlx.sock</span><br><span class="line"><span class="meta">#</span>symbolic-links=0</span><br><span class="line"><span class="meta">#</span>sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES </span><br><span class="line">[mysqld_safe]</span><br><span class="line">log-error=/var/log/mysqld.log</span><br><span class="line">pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line">3、增加数据文件夹mkdir -p /opt/docker-mysql/var/lib/mysql</span><br><span class="line">4、启动mysql</span><br><span class="line">docker run --name mysql --restart=always -p 3306:3306 \</span><br><span class="line">-v /opt/docker-mysql/conf.d:/etc/mysql/conf.d \</span><br><span class="line">-v /opt/docker-mysql/var/lib/mysql:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=comlc -d mysql:8.0.16</span><br><span class="line">5、常用命令</span><br><span class="line">进入容器docker exec -it mysql bash</span><br><span class="line">mysql登录mysql -u root -p或mysql -u root -p -h 192.168.2.102</span><br><span class="line">查看日志docker logs -f mysql</span><br><span class="line">备份数据docker exec mysql sh -c 'exec mysqldump --all-databases -uroot -p"comlc"' &gt; /some/path/on/your/host/all-databases.sql</span><br><span class="line">恢复数据docker exec -i mysql sh -c 'exec mysql -uroot -p"comlc"' &lt; /some/path/on/your/host/all-databases.sql</span><br><span class="line">重启容器docker restart mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>Redis镜像安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1、docker pull redis:latest</span><br><span class="line">2、mkdir -p /opt/docker-redis/conf</span><br><span class="line">mkdir -p /opt/docker-redis/data</span><br><span class="line">3、获取redis的默认配置模版</span><br><span class="line">wget https://raw.githubusercontent.com/antirez/redis/4.0/redis.conf -O /opt/docker-redis/conf/redis.conf</span><br><span class="line">4、vim /opt/docker-redis/conf/redis.conf修改配置为</span><br><span class="line">bind 127.0.0.1 #注释掉这部分，这是限制redis只能本地访问</span><br><span class="line">protected-mode no #默认yes，开启保护模式，限制为本地访问</span><br><span class="line">daemonize no#默认no，改为yes意为以守护进程方式启动，可后台运行，除非kill进程，改为yes会使配置文件方#式启动redis失败</span><br><span class="line">appendonly yes #redis持久化（可选）</span><br><span class="line">requirepass comlc #个人测试使用的密码</span><br><span class="line">5、docker run --restart=always -p 6379:6379 --name redis \</span><br><span class="line">-v /opt/docker-redis/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-v /opt/docker-redis/data:/data \</span><br><span class="line">-d redis redis-server /etc/redis/redis.conf --appendonly yes</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">comlc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://comlc.github.io/2019/08/20/Docker使用/">https://comlc.github.io/2019/08/20/Docker使用/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://comlc.github.io" target="_blank">COMLCのBlog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Docker/">Docker</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/10/20/APM全链路监控/"><i class="fa fa-chevron-left">  </i><span>Skywalking编译与部署</span></a></div><div class="next-post pull-right"><a href="/2018/11/24/Tesseract-OCR4源码编译与使用/"><span>Tesseract-OCR4源码编译与使用</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://comlc.github.io/2019/08/20/Docker使用/';
  this.page.identifier = '2019/08/20/Docker使用/';
  this.page.title = 'Docker使用';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'fridolph' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-src" src="https://fridolph.disqus.com/count.js" async></script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2021 By comlc</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.3"></script><script src="/js/fancybox.js?version=1.5.3"></script><script src="/js/sidebar.js?version=1.5.3"></script><script src="/js/copy.js?version=1.5.3"></script><script src="/js/fireworks.js?version=1.5.3"></script><script src="/js/transition.js?version=1.5.3"></script><script src="/js/scroll.js?version=1.5.3"></script><script src="/js/head.js?version=1.5.3"></script></body></html>